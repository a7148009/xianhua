<wxs module="utils">
  var formatDate = function(date) {
    if (!date) return '';
    var d = getDate(date);
    var year = d.getFullYear();
    var month = d.getMonth() + 1;
    var day = d.getDate();

    month = month < 10 ? '0' + month : month;
    day = day < 10 ? '0' + day : day;

    return year + '-' + month + '-' + day;
  }

  module.exports = {
    formatDate: formatDate
  };
</wxs>

<view class="container">
  <!-- é¡µé¢ä¿¡æ¯ -->
  <view class="page-info-card">
    <view class="page-name">{{pageInfo.page_name}}</view>
    <view class="page-desc">{{pageInfo.page_desc}}</view>
    <view class="page-meta">
      <text>æœ€å¤§æˆå‘˜: {{pageInfo.max_members}}</text>
      <text>å½“å‰æˆå‘˜: {{pageInfo.member_count}}</text>
      <text>æ–‡ç« æ•°: {{pageInfo.article_count}}</text>
    </view>
  </view>

  <!-- Tabåˆ‡æ¢ -->
  <view class="tab-bar">
    <view
      class="tab-item {{currentTab === 'active' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="active"
    >
      æ´»è·ƒæˆå‘˜
    </view>
    <view
      class="tab-item {{currentTab === 'pending' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="pending"
    >
      å¾…å®¡æ ¸ {{pendingCount > 0 ? '(' + pendingCount + ')' : ''}}
    </view>
    <view
      class="tab-item {{currentTab === 'articles' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="articles"
    >
      åˆä½œä¿¡æ¯ {{articlePendingCount > 0 ? '(' + articlePendingCount + ')' : ''}}
    </view>
  </view>

  <!-- æˆå‘˜åˆ—è¡¨ -->
  <view wx:if="{{currentTab !== 'articles'}}" class="member-list">
    <view
      wx:for="{{members}}"
      wx:key="_id"
      class="member-item"
    >
      <image
        class="member-avatar"
        src="{{item.user_info.avatarUrl || '/images/default-avatar.png'}}"
        mode="aspectFill"
      />
      <view class="member-info">
        <text class="member-name">{{item.user_info.nickName || 'æœªçŸ¥ç”¨æˆ·'}}</text>
        <view class="member-meta">
          <text class="meta-item">ğŸ“ å‘å¸ƒ {{item.published_count}} ç¯‡</text>
          <text class="meta-item">ğŸ• {{currentTab === 'active' ? 'åŠ å…¥' : 'ç”³è¯·'}}: {{utils.formatDate(currentTab === 'active' ? item.approve_time : item.apply_time)}}</text>
        </view>
      </view>

      <!-- å¾…å®¡æ ¸æˆå‘˜çš„æ“ä½œæŒ‰é’® -->
      <view wx:if="{{currentTab === 'pending'}}" class="member-actions">
        <button
          class="action-btn approve-btn"
          catchtap="approveMember"
          data-member="{{item}}"
        >
          é€šè¿‡
        </button>
        <button
          class="action-btn reject-btn"
          catchtap="rejectMember"
          data-member="{{item}}"
        >
          æ‹’ç»
        </button>
      </view>

      <!-- æ´»è·ƒæˆå‘˜çš„æ“ä½œæŒ‰é’® -->
      <view wx:if="{{currentTab === 'active'}}" class="member-actions">
        <button
          class="action-btn remove-btn"
          catchtap="removeMember"
          data-member="{{item}}"
        >
          ç§»é™¤
        </button>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{members.length === 0 && !loading}}" class="empty-state">
      <text class="empty-icon">ğŸ‘¥</text>
      <text class="empty-text">
        {{currentTab === 'active' ? 'è¿˜æ²¡æœ‰æ´»è·ƒæˆå‘˜' : 'æš‚æ— å¾…å®¡æ ¸ç”³è¯·'}}
      </text>
    </view>
  </view>

  <!-- åˆä½œä¿¡æ¯åˆ—è¡¨ -->
  <view wx:if="{{currentTab === 'articles'}}" class="article-list">
    <view
      wx:for="{{pendingArticles}}"
      wx:key="_id"
      class="article-review-item"
      bindtap="viewArticleDetail"
      data-article="{{item}}"
    >
      <!-- å·¦ä¾§å¤´åƒ -->
      <image
        class="author-avatar"
        src="{{item.author_info.avatarUrl}}"
        mode="aspectFill"
      />

      <!-- å³ä¾§æ–‡ç« ä¿¡æ¯ -->
      <view class="article-info">
        <view class="article-title">{{item.title}}</view>
        <view class="article-preview">{{item.content}}</view>
        <view class="article-meta">
          <text class="meta-author">{{item.author_info.nickName}}</text>
          <text class="meta-time">{{utils.formatDate(item.create_time)}}</text>
          <view class="review-status {{item.review_status}}">
            <text wx:if="{{item.review_status === 'pending'}}">å®¡æ ¸ä¸­</text>
            <text wx:if="{{item.review_status === 'approved'}}">å·²é€šè¿‡</text>
            <text wx:if="{{item.review_status === 'rejected'}}">å·²æ‹’ç»</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{pendingArticles.length === 0 && !loading}}" class="empty-state">
      <text class="empty-icon">ğŸ“„</text>
      <text class="empty-text">æš‚æ— å¾…å®¡æ ¸æ–‡ç« </text>
    </view>
  </view>
</view>
