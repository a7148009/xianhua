<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">æˆ‘çš„è®¢å•</text>
  </view>

  <!-- æ ‡ç­¾ç­›é€‰ -->
  <view class="filter-tabs">
    <view
      wx:for="{{tabs}}"
      wx:key="key"
      class="tab-item {{currentTab === item.key ? 'active' : ''}}"
      bindtap="onTabChange"
      data-key="{{item.key}}"
    >
      <text class="tab-text">{{item.label}}</text>
    </view>
  </view>

  <!-- è®¢å•åˆ—è¡¨ -->
  <view class="order-list">
    <!-- åŠ è½½ä¸­ -->
    <view wx:if="{{loading}}" class="loading-state">
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:elif="{{orders.length === 0}}" class="empty-state">
      <view class="empty-icon">ğŸ“‹</view>
      <text class="empty-text">æš‚æ— è®¢å•</text>
      <text class="empty-hint">å»è´­ä¹°VIPä¼šå‘˜äº«å—æ›´å¤šæœåŠ¡å§</text>
      <button class="buy-vip-btn" bindtap="navigateToBuyVIP">ç«‹å³è´­ä¹°VIP</button>
    </view>

    <!-- è®¢å•å¡ç‰‡ -->
    <view wx:else>
      <view
        wx:for="{{orders}}"
        wx:key="_id"
        class="order-card"
        bindtap="viewOrderDetail"
        data-order-no="{{item.order_no}}"
      >
        <!-- è®¢å•å¤´éƒ¨ -->
        <view class="order-header">
          <view class="order-no">
            <text class="label">è®¢å•å·ï¼š</text>
            <text class="value">{{item.order_no}}</text>
          </view>
          <view class="order-status {{item.status === 'refunded' ? 'refunded' : (item.is_expired ? 'expired' : 'active')}}">
            {{item.status_text}}
          </view>
        </view>

        <!-- è®¢å•å†…å®¹ -->
        <view class="order-content">
          <view class="order-info-row">
            <text class="info-label">æ”¯ä»˜é‡‘é¢</text>
            <text class="info-value price">Â¥{{item.amount_yuan}}</text>
          </view>
          <view class="order-info-row">
            <text class="info-label">VIPæ—¶é•¿</text>
            <text class="info-value">{{item.vip_duration}}å¤©</text>
          </view>
          <view class="order-info-row">
            <text class="info-label">æ”¯ä»˜æ—¶é—´</text>
            <text class="info-value">{{item.pay_time_str}}</text>
          </view>
          <view class="order-info-row">
            <text class="info-label">VIPæœ‰æ•ˆæœŸ</text>
            <text class="info-value">{{item.vip_start_date_str}} è‡³ {{item.vip_end_date_str}}</text>
          </view>
        </view>

        <!-- è®¢å•æ“ä½œ -->
        <view class="order-actions">
          <button class="action-btn detail" catchtap="viewOrderDetail" data-order-no="{{item.order_no}}">
            æŸ¥çœ‹è¯¦æƒ…
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view wx:if="{{!loading && orders.length > 0 && hasMore}}" class="load-more" bindtap="loadMore">
    <text class="load-more-text">åŠ è½½æ›´å¤š</text>
  </view>

  <view wx:if="{{!loading && orders.length > 0 && !hasMore}}" class="no-more">
    <text class="no-more-text">æ²¡æœ‰æ›´å¤šè®¢å•äº†</text>
  </view>
</view>
