<!-- pages/partner/article-list/article-list.wxml -->
<wxs module="utils">
  var formatDate = function(date) {
    if (!date) return '';
    var d = getDate(date);
    var now = getDate();
    var diff = now.getTime() - d.getTime();
    var minutes = Math.floor(diff / 60000);
    var hours = Math.floor(diff / 3600000);
    var days = Math.floor(diff / 86400000);

    if (minutes < 1) return 'åˆšåˆš';
    if (minutes < 60) return minutes + 'åˆ†é’Ÿå‰';
    if (hours < 24) return hours + 'å°æ—¶å‰';
    if (days < 7) return days + 'å¤©å‰';

    var year = d.getFullYear();
    var month = '' + (d.getMonth() + 1);
    var day = '' + d.getDate();
    if (month.length < 2) month = '0' + month;
    if (day.length < 2) day = '0' + day;
    return year + '-' + month + '-' + day;
  };

  module.exports = {
    formatDate: formatDate
  };
</wxs>

<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="page-name">{{pageInfo.page_name}}</view>
    <view class="page-meta">
      <text>ğŸ“ {{pageInfo.article_count}} ç¯‡æ–‡ç« </text>
      <text>ğŸ‘¥ {{pageInfo.member_count}} ä½æˆå‘˜</text>
    </view>
  </view>

  <!-- æ’åºåˆ‡æ¢ -->
  <view wx:if="{{isPromoter}}" class="sort-switch-bar">
    <view class="sort-label">æ’åºæ–¹å¼ï¼š</view>
    <view class="sort-tabs">
      <view
        class="sort-tab {{sortMode === 'default' ? 'active' : ''}}"
        bindtap="switchSortMode"
      >
        é»˜è®¤æ’åº
      </view>
      <view
        class="sort-tab {{sortMode === 'promotion' ? 'active' : ''}}"
        bindtap="switchSortMode"
      >
        æ¨å¹¿æ’åº
      </view>
    </view>
  </view>

  <!-- æ–‡ç« åˆ—è¡¨ -->
  <view class="article-list">
    <view
      wx:for="{{articles}}"
      wx:key="hash_id"
      class="info-item"
      bindtap="viewArticle"
      data-hash-id="{{item.hash_id}}"
    >
      <!-- æ ‡é¢˜è¡Œ -->
      <view class="info-title">
        <text class="info-number">{{item.display_sort}}</text>
        <text class="info-name">{{item.title}}</text>
      </view>

      <!-- æ–‡ç« å†…å®¹ -->
      <view class="info-detail">{{item.content}}</view>

      <!-- åº•éƒ¨ä¿¡æ¯ -->
      <view class="info-detail" style="margin-top: 20rpx; color: #999;">
        {{utils.formatDate(item.publish_time)}} Â· ğŸ‘ {{item.view_count}} Â· â¤ï¸ {{item.like_count}}
      </view>

      <!-- å®¡æ ¸çŠ¶æ€ -->
      <view wx:if="{{item.review_status}}" class="review-status-tag {{item.review_status}}">
        <text wx:if="{{item.review_status === 'pending'}}">â³ å®¡æ ¸ä¸­</text>
        <text wx:if="{{item.review_status === 'approved'}}">âœ“ å·²é€šè¿‡</text>
        <text wx:if="{{item.review_status === 'rejected'}}">âœ— å·²æ‹’ç»</text>
      </view>
    </view>

    <!-- åŠ è½½ä¸­ -->
    <view wx:if="{{loading}}" class="loading-more">
      <text>åŠ è½½ä¸­...</text>
    </view>

    <!-- æ²¡æœ‰æ›´å¤š -->
    <view wx:if="{{!loading && !hasMore && articles.length > 0}}" class="no-more">
      <text>æ²¡æœ‰æ›´å¤šäº†</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{!loading && articles.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ“„</text>
      <text class="empty-text">è¿˜æ²¡æœ‰æ–‡ç« </text>
      <view wx:if="{{isPromoter}}" class="empty-action" bindtap="publishArticle">
        ç«‹å³å‘å¸ƒ
      </view>
    </view>
  </view>
</view>

<!-- æµ®åŠ¨å‘å¸ƒæŒ‰é’® -->
<view wx:if="{{isPromoter}}" class="publish-fab" bindtap="publishArticle">
  <text class="fab-icon">+</text>
</view>
