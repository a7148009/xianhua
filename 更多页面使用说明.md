# 更多页面功能说明

## 功能概述
"更多"页面(原消息页面)用于展示额外的信息内容,支持数据化排序、智能联系方式识别和VIP权限控制。

## 核心功能

### 1. 数据结构
- **排序值**: 1-5000,每条信息有唯一的排序值
- **标题**: 信息标题
- **内容**: 详细内容,支持多行文本
- **可见性**: 只显示可见的信息,隐藏的不展示

### 2. 智能联系方式识别

#### 电话号码识别
工具函数会自动识别以下格式:
- 带标识的电话: `电话:13800138000`、`手机：138-0000-0000`
- 11位手机号: `13800138000`
- 固定电话: `0871-12345678`
- 400/800电话: `400-123-4567`
- 带空格或短横线: `138 0000 0000`

#### 微信号识别
工具函数会自动识别以下格式:
- 带标识的微信: `微信:abc123`、`VX：username123`
- 微信同号: `微信同号`、`微信:手机号`
- 纯数字微信号(QQ号): `微信:12345678`
- 标准微信号格式: 字母开头,6-20位

### 3. VIP权限控制

#### 普通用户
- 电话号码显示为: `138****0000`
- 微信号显示为: `abc****123`
- 无法复制或拨打联系方式
- 显示VIP开通提示

#### VIP/管理员用户
- 完整显示所有联系方式
- 可以复制电话和微信号
- 可以直接拨打电话

## 云函数说明

### moreInfoManager
位置: `cloudfunctions/moreInfoManager/`

#### 支持的操作
1. **getList** - 获取列表
   - 参数: `page`, `limit`
   - 返回: 分页数据

2. **getDetail** - 获取详情
   - 参数: `id`
   - 返回: 单条详细信息

3. **add** - 添加信息(管理员)
   - 参数: `sortOrder`, `title`, `content`

4. **update** - 更新信息(管理员)
   - 参数: `id`, `sortOrder`, `title`, `content`, `isVisible`

5. **delete** - 删除信息(管理员,软删除)
   - 参数: `id`

## 数据库集合

### more_info
```javascript
{
  _id: String,
  sortOrder: Number,        // 排序值 1-5000
  title: String,            // 标题
  content: String,          // 内容
  isVisible: Boolean,       // 是否可见
  createTime: Date,         // 创建时间
  updateTime: Date,         // 更新时间
  createBy: String,         // 创建人openid
  deleteTime: Date          // 删除时间(软删除)
}
```

## 页面交互

1. **点击标题** - 展开/收起内容
2. **复制按钮** - 复制联系方式(VIP)
3. **拨打按钮** - 拨打电话(VIP)
4. **下拉刷新** - 刷新列表数据
5. **上拉加载** - 加载更多数据

## 样式特点

- 采用小程序统一风格(橙色渐变主题)
- 卡片式设计,圆角阴影
- 排序号醒目显示
- VIP提示金色渐变
- 动画效果流畅自然

## 使用流程

### 管理员添加信息
1. 调用云函数 `moreInfoManager`
2. action: `add`
3. 提供 `sortOrder`(1-5000)、`title`、`content`

### 用户查看信息
1. 进入"更多"页面
2. 点击标题查看详情
3. 查看联系方式(根据权限)
4. 复制或拨打联系方式(VIP)

## 智能识别示例

### 示例1:标准格式
```
内容: 电话:13800138000,微信:abc123
识别结果:
- 电话: ["13800138000"]
- 微信: ["abc123"]
```

### 示例2:混合格式
```
内容: 联系方式:138-0000-0000,VX同号
识别结果:
- 电话: ["13800000000"]
- 微信: ["13800000000"] (微信同号)
```

### 示例3:多个联系方式
```
内容:
电话:13800138000
手机:13900139000
微信:user123
VX:user456
识别结果:
- 电话: ["13800138000", "13900139000"]
- 微信: ["user123", "user456"]
```

## 注意事项

1. 排序值必须唯一,1-5000范围内
2. 联系方式识别支持中英文标识
3. 普通用户看不到完整联系方式
4. VIP/Admin才能查看和操作联系方式
5. 删除为软删除,数据不会真正删除

## 部署步骤

1. 上传云函数:
   ```bash
   右键 cloudfunctions/moreInfoManager -> 上传并部署:云端安装依赖
   ```

2. 创建数据库集合:
   - 集合名: `more_info`
   - 权限: 仅管理员可写,所有人可读

3. 测试功能:
   - 添加测试数据
   - 检查识别效果
   - 验证VIP权限

## 扩展建议

1. 可添加搜索功能
2. 可添加分类筛选
3. 可添加收藏功能
4. 可添加分享功能
5. 可添加评论功能
