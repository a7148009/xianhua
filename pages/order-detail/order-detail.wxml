<view class="container">
  <!-- åŠ è½½ä¸­ -->
  <view wx:if="{{loading}}" class="loading-container">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- è®¢å•è¯¦æƒ… -->
  <view wx:else class="detail-container">
    <!-- è®¢å•çŠ¶æ€å¡ç‰‡ -->
    <view class="status-card">
      <view class="status-icon {{order.status === 'refunded' ? 'refunded' : (order.is_expired ? 'expired' : 'active')}}">
        {{order.status === 'refunded' ? 'âŒ' : (order.is_expired ? 'â°' : 'âœ…')}}
      </view>
      <text class="status-text">{{order.status_text}}</text>
      <text class="status-desc" wx:if="{{order.status === 'paid' && !order.is_expired}}">
        VIPæœ‰æ•ˆæœŸè‡³ {{order.vip_end_date_str}}
      </text>
      <text class="status-desc" wx:elif="{{order.is_expired}}">
        å·²äº {{order.vip_end_date_str}} è¿‡æœŸ
      </text>
      <text class="status-desc" wx:elif="{{order.status === 'refunded'}}">
        å·²äº {{order.refund_time_str}} é€€æ¬¾
      </text>
    </view>

    <!-- è®¢å•ä¿¡æ¯ -->
    <view class="info-section">
      <view class="section-title">è®¢å•ä¿¡æ¯</view>
      <view class="info-list">
        <view class="info-item">
          <text class="item-label">è®¢å•å·</text>
          <view class="item-value-row">
            <text class="item-value">{{order.order_no}}</text>
            <button class="copy-btn" bindtap="copyOrderNo">å¤åˆ¶</button>
          </view>
        </view>
        <view class="info-item">
          <text class="item-label">æ”¯ä»˜é‡‘é¢</text>
          <text class="item-value price">Â¥{{order.amount_yuan}}</text>
        </view>
        <view class="info-item">
          <text class="item-label">VIPæ—¶é•¿</text>
          <text class="item-value">{{order.vip_duration}}å¤©</text>
        </view>
        <view class="info-item">
          <text class="item-label">åˆ›å»ºæ—¶é—´</text>
          <text class="item-value">{{order.create_time_str}}</text>
        </view>
        <view class="info-item">
          <text class="item-label">æ”¯ä»˜æ—¶é—´</text>
          <text class="item-value">{{order.pay_time_str}}</text>
        </view>
      </view>
    </view>

    <!-- VIPæœ‰æ•ˆæœŸ -->
    <view class="info-section">
      <view class="section-title">VIPæœ‰æ•ˆæœŸ</view>
      <view class="info-list">
        <view class="info-item">
          <text class="item-label">å¼€å§‹æ—¶é—´</text>
          <text class="item-value">{{order.vip_start_date_str}}</text>
        </view>
        <view class="info-item">
          <text class="item-label">ç»“æŸæ—¶é—´</text>
          <text class="item-value">{{order.vip_end_date_str}}</text>
        </view>
        <view class="info-item">
          <text class="item-label">å½“å‰çŠ¶æ€</text>
          <text class="item-value {{order.is_expired ? 'expired-text' : 'active-text'}}">
            {{order.is_expired ? 'å·²è¿‡æœŸ' : 'ä½¿ç”¨ä¸­'}}
          </text>
        </view>
      </view>
    </view>

    <!-- æ”¯ä»˜è¯¦æƒ… -->
    <view class="info-section">
      <view class="section-title">æ”¯ä»˜è¯¦æƒ…</view>
      <view class="info-list">
        <view class="info-item">
          <text class="item-label">å¾®ä¿¡æ”¯ä»˜äº¤æ˜“å·</text>
          <view class="item-value-row">
            <text class="item-value small">{{order.transaction_id}}</text>
            <button class="copy-btn" bindtap="copyTransactionId">å¤åˆ¶</button>
          </view>
        </view>
      </view>
    </view>

    <!-- é€€æ¬¾ä¿¡æ¯ï¼ˆä»…é€€æ¬¾è®¢å•æ˜¾ç¤ºï¼‰ -->
    <view wx:if="{{order.status === 'refunded'}}" class="info-section refund-section">
      <view class="section-title">é€€æ¬¾ä¿¡æ¯</view>
      <view class="info-list">
        <view class="info-item">
          <text class="item-label">é€€æ¬¾æ—¶é—´</text>
          <text class="item-value">{{order.refund_time_str}}</text>
        </view>
        <view class="info-item" wx:if="{{order.refund_reason}}">
          <text class="item-label">é€€æ¬¾åŸå› </text>
          <text class="item-value">{{order.refund_reason}}</text>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
    <view class="bottom-actions">
      <button class="action-btn secondary" bindtap="contactService">
        <text class="btn-icon">ğŸ“</text>
        <text>è”ç³»å®¢æœ</text>
      </button>
      <button class="action-btn primary" bindtap="navigateToOrders">
        <text class="btn-icon">ğŸ“‹</text>
        <text>è¿”å›è®¢å•åˆ—è¡¨</text>
      </button>
    </view>
  </view>
</view>
