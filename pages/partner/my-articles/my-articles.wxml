<!-- pages/partner/my-articles/my-articles.wxml -->
<view class="container">
  <!-- Tabæ  -->
  <view class="tab-bar">
    <view
      class="tab-item {{currentTab === 'all' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="all"
    >
      å…¨éƒ¨
    </view>
    <view
      class="tab-item {{currentTab === 'pending' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="pending"
    >
      å¾…å®¡æ ¸
    </view>
    <view
      class="tab-item {{currentTab === 'approved' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="approved"
    >
      å·²é€šè¿‡
    </view>
    <view
      class="tab-item {{currentTab === 'rejected' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="rejected"
    >
      å·²æ‹’ç»
    </view>
  </view>

  <!-- æ–‡ç« åˆ—è¡¨ -->
  <view class="article-list">
    <view
      wx:for="{{articles}}"
      wx:key="hash_id"
      class="article-card"
    >
      <!-- æ–‡ç« ä¿¡æ¯ -->
      <view class="article-main" bindtap="viewArticle" data-hash-id="{{item.hash_id}}">
        <view class="article-header">
          <text class="article-title">{{item.title}}</text>
          <view class="status-badges">
            <view class="publish-type {{item.publish_type}}">
              {{item.publish_type === 'partner' ? 'åˆä½œ' : 'ä»˜è´¹'}}
            </view>
            <view class="review-status {{item.review_status || 'pending'}}">
              <text wx:if="{{(item.review_status || 'pending') === 'pending'}}">å®¡æ ¸ä¸­</text>
              <text wx:if="{{(item.review_status || 'pending') === 'approved'}}">å·²é€šè¿‡</text>
              <text wx:if="{{(item.review_status || 'pending') === 'rejected'}}">å·²æ‹’ç»</text>
            </view>
          </view>
        </view>

        <view class="article-content">{{item.content}}</view>

        <!-- å›¾ç‰‡é¢„è§ˆï¼ˆæœ€å¤š3å¼ ï¼‰ -->
        <view wx:if="{{item.images && item.images.length > 0}}" class="article-images">
          <image
            wx:for="{{item.images}}"
            wx:for-item="img"
            wx:key="index"
            wx:if="{{index < 3}}"
            class="article-img"
            src="{{img}}"
            mode="aspectFill"
          />
        </view>

        <view class="article-meta">
          <text class="meta-item">æ’åº: {{item.default_sort}}</text>
          <text class="meta-item">ğŸ‘ {{item.view_count}}</text>
          <text class="meta-item">â¤ï¸ {{item.like_count}}</text>
          <text class="meta-item">ğŸ”— {{item.share_count}}</text>
        </view>

        <!-- æ¨å¹¿ç§¯åˆ† -->
        <view wx:if="{{item.publish_type === 'partner'}}" class="score-info">
          <text class="score-label">æ¨å¹¿ç§¯åˆ†:</text>
          <text class="score-value {{item.is_score_sufficient ? 'sufficient' : 'insufficient'}}">
            {{item.promotion_score}}
          </text>
          <text wx:if="{{!item.is_score_sufficient}}" class="score-warning">âš ï¸ ç§¯åˆ†ä¸è¶³</text>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="article-actions">
        <button
          wx:if="{{item.status === 'active'}}"
          class="action-btn stats-btn"
          catchtap="viewStats"
          data-hash-id="{{item.hash_id}}"
        >
          ğŸ“Š ç»Ÿè®¡
        </button>
        <button
          wx:if="{{item.status === 'active'}}"
          class="action-btn edit-btn"
          catchtap="editArticle"
          data-article="{{item}}"
        >
          âœï¸ ç¼–è¾‘
        </button>
        <button
          wx:if="{{item.status === 'active'}}"
          class="action-btn delete-btn"
          catchtap="deleteArticle"
          data-article="{{item}}"
        >
          ğŸ—‘ï¸ åˆ é™¤
        </button>
        <button
          wx:if="{{item.status === 'pending'}}"
          class="action-btn pay-btn"
          catchtap="viewArticle"
          data-hash-id="{{item.hash_id}}"
        >
          ğŸ’³ å»æ”¯ä»˜
        </button>
      </view>
    </view>

    <!-- åŠ è½½ä¸­ -->
    <view wx:if="{{loading}}" class="loading-more">
      <text>åŠ è½½ä¸­...</text>
    </view>

    <!-- æ²¡æœ‰æ›´å¤š -->
    <view wx:if="{{!loading && !hasMore && articles.length > 0}}" class="no-more">
      <text>æ²¡æœ‰æ›´å¤šäº†</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{!loading && articles.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ“„</text>
      <text class="empty-text">
        <block wx:if="{{currentTab === 'all'}}">è¿˜æ²¡æœ‰å‘å¸ƒä»»ä½•æ–‡ç« </block>
        <block wx:elif="{{currentTab === 'pending'}}">æ²¡æœ‰å¾…å®¡æ ¸çš„æ–‡ç« </block>
        <block wx:elif="{{currentTab === 'approved'}}">æ²¡æœ‰å·²é€šè¿‡çš„æ–‡ç« </block>
        <block wx:elif="{{currentTab === 'rejected'}}">æ²¡æœ‰è¢«æ‹’ç»çš„æ–‡ç« </block>
      </text>
      <view wx:if="{{currentTab === 'all'}}" class="empty-action" bindtap="publishNew">
        å»å‘å¸ƒ
      </view>
    </view>
  </view>
</view>
