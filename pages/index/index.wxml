<view class="container">
  <!-- éª¨æ¶å± -->
  <view wx:if="{{showSkeleton}}" class="skeleton-container">
    <!-- æœç´¢éª¨æ¶ -->
    <view class="skeleton-search">
      <view class="skeleton-box skeleton-animate"></view>
    </view>

    <!-- åˆ†ç±»éª¨æ¶ -->
    <view class="skeleton-category">
      <view class="skeleton-category-row">
        <view class="skeleton-tag skeleton-animate"></view>
        <view class="skeleton-tag skeleton-animate"></view>
        <view class="skeleton-tag skeleton-animate"></view>
        <view class="skeleton-tag skeleton-animate"></view>
      </view>
      <view class="skeleton-category-row">
        <view class="skeleton-tag skeleton-animate"></view>
        <view class="skeleton-tag skeleton-animate"></view>
        <view class="skeleton-tag skeleton-animate"></view>
      </view>
    </view>

    <!-- åˆ—è¡¨éª¨æ¶ -->
    <view class="skeleton-list">
      <view class="skeleton-item" wx:for="{{[1,2,3,4,5]}}" wx:key="*this">
        <view class="skeleton-item-header">
          <view class="skeleton-title skeleton-animate"></view>
          <view class="skeleton-price skeleton-animate"></view>
        </view>
        <view class="skeleton-tags">
          <view class="skeleton-tag-small skeleton-animate"></view>
          <view class="skeleton-tag-small skeleton-animate"></view>
          <view class="skeleton-tag-small skeleton-animate"></view>
        </view>
        <view class="skeleton-company">
          <view class="skeleton-avatar skeleton-animate"></view>
          <view class="skeleton-text skeleton-animate"></view>
        </view>
      </view>
    </view>
  </view>

  <!-- çœŸå®å†…å®¹ -->
  <view wx:else class="real-content">
    <!-- æœç´¢å®¹å™¨ -->
    <view class="search-container">
      <view class="search-box">
        <text class="search-icon">ğŸ”</text>
        <input class="search-input" placeholder="{{searchPlaceholder}}" bindinput="onSearchInput" bindconfirm="onSearchConfirm"/>
      </view>
    </view>

    <!-- åˆ†ç±»åŒºåŸŸ -->
    <view class="category-section">
      <!-- ç±»å‹åˆ†ç±»ï¼ˆåŠ¨æ€åŠ è½½ï¼‰ -->
      <view class="category-list">
        <view
          wx:for="{{categoryList}}"
          wx:key="_id"
          class="category-item {{currentType === item._id ? 'active' : ''}}"
          bindtap="onTypeChange"
          data-id="{{item._id}}"
          data-name="{{item.name}}"
          data-is-vip="{{item.isVIP}}"
        >
          <text class="category-text">{{item.name}}</text>
        </view>
        <!-- å¦‚æœæ²¡æœ‰é…ç½®æ•°æ®ï¼Œæ˜¾ç¤ºæç¤º -->
        <view wx:if="{{categoryList.length === 0}}" class="category-empty">
          <text>æš‚æ— åˆ†ç±»</text>
        </view>
      </view>

      <!-- åœ°åŒºåˆ†ç±»ï¼ˆåŠ¨æ€åŠ è½½ï¼‰ -->
      <view class="area-list">
        <view
          wx:for="{{areaList}}"
          wx:key="_id"
          class="area-item {{currentArea === item._id ? 'active' : ''}}"
          bindtap="onAreaChange"
          data-id="{{item._id}}"
          data-name="{{item.name}}"
        >
          <text class="area-text">{{item.name}}</text>
        </view>
        <!-- å¦‚æœæ²¡æœ‰é…ç½®æ•°æ®ï¼Œæ˜¾ç¤ºæç¤º -->
        <view wx:if="{{areaList.length === 0}}" class="area-empty">
          <text>æš‚æ— åŒºåŸŸ</text>
        </view>
      </view>
    </view>

    <!-- æ¨èæ¿å— -->
    <view class="recommendation-section">
      <view class="rec-header">
        <text class="rec-title">ä¸ºä½ æ¨è</text>
        <text class="rec-count">{{totalCount}}æ¡ä¿¡æ¯</text>
      </view>
      <view class="rec-tags">
        <text class="rec-tag {{currentSort === 'recommend' ? 'active' : ''}}" bindtap="onSortChange" data-sort="recommend">æ¨è</text>
        <text class="rec-tag {{currentSort === 'newest' ? 'active' : ''}}" bindtap="onSortChange" data-sort="newest">æœ€æ–°</text>
        <text class="rec-tag {{currentSort === 'nearby' ? 'active' : ''}}" bindtap="onSortChange" data-sort="nearby">é™„è¿‘</text>
        <text class="rec-tag location {{cityFilterActive ? 'active' : ''}}" bindtap="onCityFilterToggle">ğŸ“ æ˜†æ˜</text>
        <view class="rec-tag filter {{currentDistance ? 'active' : ''}}" bindtap="toggleDistanceFilter">
          <text class="filter-text">{{currentDistance ? currentDistance + 'å…¬é‡Œå†…' : 'ç­›é€‰'}}</text>
          <text class="filter-icon">ğŸ”½</text>
        </view>
      </view>

      <!-- è·ç¦»ç­›é€‰ä¸‹æ‹‰èœå• -->
      <view wx:if="{{showDistanceFilter}}" class="distance-filter-dropdown">
        <view class="distance-option {{currentDistance === '1' ? 'active' : ''}}" bindtap="onDistanceChange" data-distance="1">
          1å…¬é‡Œå†…
        </view>
        <view class="distance-option {{currentDistance === '3' ? 'active' : ''}}" bindtap="onDistanceChange" data-distance="3">
          3å…¬é‡Œå†…
        </view>
        <view class="distance-option {{currentDistance === '5' ? 'active' : ''}}" bindtap="onDistanceChange" data-distance="5">
          5å…¬é‡Œå†…
        </view>
        <view class="distance-option {{currentDistance === '10' ? 'active' : ''}}" bindtap="onDistanceChange" data-distance="10">
          10å…¬é‡Œå†…
        </view>
        <view class="distance-option" bindtap="onDistanceChange" data-distance="">
          ä¸é™è·ç¦»
        </view>
      </view>
    </view>

    <!-- èŒä½åˆ—è¡¨ -->
    <view class="job-list">
      <!-- æ™ºèƒ½åŠ è½½é®ç½© -->
      <view wx:if="{{smartLoading}}" class="smart-loading-overlay">
        <view class="smart-loading-content">
          <view class="loading-spinner"></view>
          <text class="loading-text">åŠ è½½ä¸­...</text>
        </view>
      </view>

      <!-- èŒä½å¡ç‰‡ -->
    <view wx:for="{{jobList}}" wx:key="hash_id" class="job-item" bindtap="goToDetail" data-item="{{item}}">
      <!-- èŒä½ä¸»è¦ä¿¡æ¯ -->
      <view class="job-main">
        <view class="job-header">
          <text class="job-title">{{item.title}}</text>
          <view class="job-salary-container">
            <text class="job-salary">{{item.salary || 'é¢è®®'}}</text>
          </view>
        </view>
        <view class="job-location-info">
          <text wx:if="{{item.area}}" class="location-area">{{item.area}}</text>
          <block wx:for="{{item.categories}}" wx:key="index" wx:for-item="category">
            <text wx:if="{{item.area || index > 0}}" class="location-separator"> â€¢ </text>
            <text class="location-category">{{category}}</text>
          </block>
        </view>
      </view>

      <!-- æ‹›è˜äººå‘˜ä¿¡æ¯ -->
      <view class="recruiter-section">
        <view class="recruiter-info">
          <view class="recruiter-avatar">
            <view class="avatar-placeholder {{item.isVIP ? 'vip-avatar' : 'normal-avatar'}}">
              {{item.isVIP ? 'é«˜' : 'æ™®'}}
            </view>
            <view class="online-dot"></view>
          </view>
          <view class="recruiter-details">
            <text class="company-name-bold">{{item.company_name || 'å…¬å¸åç§°'}}</text>
            <text class="company-meta">æ€»é˜…è¯»{{item.totalViews}}æ¬¡ | ä»Šæ—¥é˜…è¯»{{item.todayViews}}æ¬¡</text>
          </view>
          <view class="action-area">
            <text class="publish-time-info">{{item.postTime || 'åˆšåˆšå‘å¸ƒ'}}</text>
            <view class="call-button-rect" catchtap="makePhoneCall" data-phone="{{item.contact_phone}}" data-access-level="{{item.access_level}}">
              <text class="call-icon-green">ğŸ“</text>
              <text class="call-text-rect">æ‹¨æ‰“ç”µè¯</text>
            </view>
          </view>
        </view>
      </view>

      <!-- èŒä½æ ‡ç­¾ -->
      <view class="job-tags-section">
        <view class="job-requirement-tags">
          <text wx:for="{{item.tags}}" wx:key="index" wx:for-item="tag" class="req-tag">{{tag.name}}</text>
        </view>
      </view>

      <!-- å·¥ä½œå†…å®¹é¢„è§ˆ -->
      <view wx:if="{{item.descriptionPreview}}" class="job-description-preview">
        <view class="desc-title">{{workContentLabel}}ï¼š</view>
        <view class="desc-content">{{item.descriptionPreview}}</view>
      </view>
    </view>
  </view>

  <!-- è°ƒè¯•å·¥å…·ï¼ˆç‚¹å‡»æ ‡é¢˜5æ¬¡è§¦å‘ï¼‰ -->
  <view class="debug-trigger" bindtap="toggleDebug"></view>
  <view wx:if="{{showDebug}}" class="debug-tools">
    <view class="debug-title">è°ƒè¯•å·¥å…·</view>
    <view class="debug-btn" bindtap="initializeDatabase">åˆå§‹åŒ–æ•°æ®åº“</view>
    <view class="debug-btn" bindtap="quickFix">å¿«é€Ÿä¿®å¤</view>
      <view class="debug-btn" bindtap="createDatabaseCollection">åˆ›å»ºé›†åˆ</view>
      <view class="debug-btn" bindtap="setupFreeEnvironment">å…è´¹ç¯å¢ƒé…ç½®</view>
      <view class="debug-btn" bindtap="goToDatabaseCreator">æ•°æ®åº“å·¥å…·å°</view>
    </view>
  </view>
</view>
